{% extends 'base.html' %}
{% load custom_filters %}

{% load static %}
{% load humanize %}

{% block style %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
<link rel="stylesheet" href="{% static 'css/mountains_detail.css' %}">
<link rel="stylesheet" href="{% static 'css/level.css' %}">
{% endblock style %}

{% block content %}
<div class="wrap position--relative">
  <section class="mountain__info--wrap">
    <div class="mountains__detail--infobox">
      <div class="mountain__img--wrap">
        <div class="mountains__detail--imgbox">
          <img class="mountains__detail--img" src="{% get_static_prefix %}img/mountains/{{ mountain.name }}.png" alt="">
          {% if mountain.top_tags %}
            <div class="mountain__detail--infotag">
              {% for tag in mountain.top_tags  %}
                <span style="margin-right: 5px;">#{{ tag }}</span>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
      <div class="mountains__detail--info">
        <div class="mountains__detail--titlebox">
          <h1 class="mountains__detail--title">{{ mountain.name }}</h1>
          <p class="mountains__detail--subtitle">{{ mountain.subname }}</p>
          <p class="mountains__detail--subtitle">ğŸš— {{ mountain_distance }} km</p>
        </div>
        <table>
          <tr class="mountains__detail--stat">
            <th>ì§€ ì—­</th>
            <td>{{ mountain.region }}</td>
          </tr>
          <tr class="mountains__detail--stat">
            <th>ê³  ë„</th>
            <td>{{ mountain.height }}m</td>
          </tr>
          {% if mountain.info is not None %}
          <tr class="mountains__detail--stat">
            <th>ì • ë³´</th>
            <td>
              <div class="overflow-hidden flex--col items-start">
                <p class="text-ellipsis line-clamp-3">
                  {{ mountain.info }}
                </p>
                <button class="mt-2 text-gray-500 underline self-end show-info-modal">ë”ë³´ê¸°</button>
              </div>
          {% endif %}
              <!-- ëª¨ë‹¬ -->
              <div id="info-modal" class="hidden fixed top-0 left-0 w-screen h-screen flex justify-center items-center bg-gray-900 bg-opacity-75" style="z-index: 9999;">
                <div class="bg-white p-4 max-w-lg flex flex-col items-start">
                  <p>{{ mountain.info }}</p>
                  <button class="mt-5 text-gray-500 underline self-end close-info-modal">ë‹«ê¸°</button>
                </div>
              </div>
            </td>
          </tr>
        </table>
        <br>
        <br>
        
        <!-- ë² ìŠ¤íŠ¸ ëŒ“ê¸€ -->
        <div class="mountain__detail--bestreview">
          <button id="viewCommentButton" class="ml-2 text-md text-gray-500" onclick="scrollToComment()">
            <div class="flex justify-center items-center">
              <p id="bestReview" class="text-ellipsis line-clamp-2">
                {% if most_liked_review %}
                  <span class="text-2xl text-gray-500">"</span>
                  {{ most_liked_review.content }}
                  <span class="text-2xl text-gray-500">"</span>
                {% endif %}
              </p>
            </div>
          </button>
        </div>

        <!-- Button trigger modal -->
        <button type="button" class="mountain__detail--mapbtn" data-bs-toggle="modal" data-bs-target="#mountainMap">
          ì§€ë„ë³´ê¸°
        </button>
      </div>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="mountainMap" tabindex="-1" aria-labelledby="mountainMapLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="mountainMapLabel">{{ mountain.name }}</h1>
            <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div id="mountain-map"></div>            
          </div>
        </div>
      </div>
    </div>
  </section>

  <hr style="margin-bottom: 30px;">

  <section class="mountain__info--wrap">
    <div class="mountain__weather-news--wrap">
      <div class="mountains__detail--weather">
        <a class="mountains__detail--weatherlink" href="{% url 'mountains:weather_forecast' mountain.pk %}">
          <div class="flex--row flex__align--between">
            <div class="weather--wrap">
              <div class="flex--row flex__align--center" style="height: 60%; margin-bottom: 14px;">
                <div class="weather--sky">
                    <img class="weather--skyimg">
                </div>
                <div class="d-flex flex-row">
                  <p class="weather--tem"></p>
                  <p style="font-size: 2rem; line-height: 140px;">â„ƒ</p>
                </div>
              </div>
              <div class="weather--detailwrap">
                <div class="weather--hvwr" data-type="hum">
                  <p>ìŠµë„</p>
                  <p></p>
                </div>
                <div style="border-right: 1px solid #DBDBDB;"></div>
                <div class="weather--hvwr" data-type="wsd">
                  <p>ë°”ëŒ</p>
                  <p></p>
                </div>
                <div style="border-right: 1px solid #DBDBDB;"></div>
                <div class="weather--hvwr" data-type="rain">
                  <p>1ì‹œê°„ê°•ìˆ˜ëŸ‰</p>
                  <p></p>
                </div>
              </div>
            </a>
          </div>
          <div class="air--warp">
            <div class="flex--col flex__align--between align-items-center">
              <div class="air--fine_dust">
                {% comment %} ë¯¸ì„¸ë¨¼ì§€ js {% endcomment %}
              </div>
              <div class="air--ozone">
                {% comment %} ì˜¤ì¡´ js {% endcomment %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="mountains__detail--newslist">
        {% comment %} ê´€ë ¨ë‰´ìŠ¤ js {% endcomment %}
      </div>
    </div>
  </section>
  
  <hr style="margin-bottom: 30px;">

  <section class="mountain__info--wrap position--relative">
    <h1 class="mountain__detail--coursetitle">{{ mountain.name }} ì½”ìŠ¤ëª©ë¡</h1>
    <ul class="mountain__detail--courselist">
      {% for course in courses|slice:":3" %}
        <li class="mountain__detail--course">
          <div class="course--wrap">
            <div class="course--map" id="map2-{{ course.pk }}"></div>
            <div class="course--infobox">
              <h5 class="coursetitle--font">{{ course.crs_name_detail }}</h5>
              <table>
                <tr>
                  <th>ì´ê±°ë¦¬</th>
                  <td>{{ course.distance }}km</td>
                </tr>
                <tr>  
                  <th>ì†Œìš”ì‹œê°„</th>
                  <td>{{ course.duration }}</td>
                </tr>
                <tr>
                  <th>ë‚œì´ë„</th>
                  <td>{{ course.diff }}</td>
                </tr>
              </table>
              <form class="download-form" data-mountain-id="{{ mountain.pk }}" data-gpx-id="{{course.pk}}">
                {% csrf_token %}
                <input type="submit" value="ğŸ’¾  GPX ë‹¤ìš´ë¡œë“œ">
              </form>
              <div class="flex--row">
                <input type="checkbox" id="waypoint-checkbox-{{ course.pk }}" onchange="toggleWaypoints({{ course.pk }})">
                <label for="waypoint-checkbox-{{ course.pk }}">ê²½ìœ ì§€ í‘œì‹œ</label>
              </div>
              <form>
                {% csrf_token %}
                {% if request.user in course.bookmarks.all %}
                <button id="bookmark-btn-{{ course.pk }}" type="submit"  class="bi bi-bookmark-fill btn--spot" data-mountain-pk="{{ mountain.pk }}" data-course-pk="{{ course.pk }}"></button>
                {% else %}
                <button id="bookmark-btn-{{ course.pk }}" type="submit"  class="bi bi-bookmark btn--spot" data-mountain-pk="{{ mountain.pk }}" data-course-pk="{{ course.pk }}"></button>
                {% endif %}
              </form>
            </div>
          </div>
        </li>
        <br>
      {% empty %}
        <li>No courses available.</li>
      {% endfor %}
    </ul>

    {% if courses|length > 3 %}
      <a class="more--course" href="{% url 'mountains:course_list' mountain.pk %}">ë”ë³´ê¸°</a>
    {% endif %}
  </section>

  <hr style="margin-bottom: 30px;">

  <!-- ë¦¬ë·° ìƒì„± -->
  <section class="mountain__info--wrap">
    <form id="review-form" action="{% url 'mountains:create_review' mountain.pk %}" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <div class="flex--col position--relative">
        <div id="review-tags" class="mountain__reviewcrt--tagbox">
          {{ form.tags|safe }}
        </div>
        <div class="flex--row flex__align--between">
          <div id="review-image">
            <div class="mountain__reviewcrt--imgbox">
              <i class="bi bi-plus-lg img--plus"></i>
              {{ form.image }}
              <img id="preview" class="preview-image" src="#" alt="Preview Image" style="display: none;">
            </div>
          </div>
          {% comment %} <div id="selected-tags" class="selected-tags"></div> {% endcomment %}
          <div id="review-content" class="mountain__reviewcrt--contbox">
            {{ form.content }}
          </div>
        </div>
        <div class="fourtag" style="display:none">íƒœê·¸ëŠ” 4ê°œê¹Œì§€ ì„ íƒê°€ëŠ¥í•©ë‹ˆë‹¤</div>
        <div class="review__submit--btn">
          <button type="submit" id="submit-button" class="btn btn-outline-success">ë“±ë¡í•˜ê¸°</button>
        </div>
      </div>
    </form>
  </section>

  <hr style="margin-bottom: 30px;">

  <!-- ë¦¬ë·° -->
  <section class="mountain__info--wrap">
    <h1 class="mountain__detail--reviewtitle">ë¦¬ë·°<span class="mountain__detail--reviewtitle2">{{ reviews|length }}</span></h1>
    <ul id="reviewList">
      {% for review in reviews %}
      <li id="best-{{ review.pk }}" {% if forloop.counter > 5 %}style="display: none;"{% endif %} class="{% if review == most_liked_review %}mountain__bestreview{% else %}mountain__review{% endif %}">
        <div class="mountain__detail--reviewbox">
          <!-- Button trigger modal -->
          {% if review.image %}
            <button type="button" class="mountain__detail--reviewcontimgbtn" data-bs-toggle="modal" data-bs-target="#reviewImg-{{ review.pk }}">
              <div class="mountain__detail--reviewcontimgbox">
                <img class="mountain__detail--reviewcontimg" src="{{ review.image.url }}" alt="">              
              </div>
            </button> 
          {% endif %}
    
          <!-- Modal -->
          <div class="modal fade" id="reviewImg-{{ review.pk }}" tabindex="-1" aria-labelledby="reviewImgLabel-{{ review.pk }}" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
              <div class="modal-content">
                <div class="modal-header">
                  <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <div class="mountain__detail--reviewmodalimgbox">
                    {% if review.image %}
                      <img class="mountain__detail--reviewcontimg" src="{{ review.image.url }}" alt="">
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="mountain__detail--contentbox">
            <div class="mountain__detail--reviewinfo">
              <a href="{% url 'accounts:profile' review.user.pk %}">
                <div class="mountain__detail--reviewimgbox">
                  {% if review.user.profile_img %}
                    <img class="mountain__detail--reviewimg {% if review.user.level == 2 %}level2 {% elif review.user.level == 3 %}level3 {% elif review.user.level == 4 %}level4 {% elif review.user.level == 5 %}level5 {% endif %}" src="{{ review.user.profile_img.url }}" alt="ë¦¬ë·°ìœ ì €ì´ë¯¸ì§€">
                    {% if review.user.level == 5 %}
                      <img class="level5--img" src="{% static 'img/crown.png' %}" alt="level5">
                    {% endif %}
                  {% else %}
                    <img class="mountain__detail--reviewimg {% if review.user.level == 2 %}level2 {% elif review.user.level == 3 %}level3 {% elif review.user.level == 4 %}level4 {% elif review.user.level == 5 %}level5 {% endif %}" src="{% static 'img/profile_no_img.png' %}" alt="ëŒ€ì²´ì´ë¯¸ì§€">
                    {% if review.user.level == 5 %}
                      <img class="level5--img" src="{% static 'img/crown.png' %}" alt="level5">
                    {% endif %}
                  {% endif %}
                </div>
              </a>
              <div class="mountain__detail--reviewuserstat">
                <div class="flex--row">
                  <a href="{% url 'accounts:profile' review.user.pk %}">
                    <p class="mountain__detail--reviewuser">{{ review.user.nickname }}</p>
                  </a>
                  <form class="review-like-form mx-3" id="like-form-{{ review.pk }}" data-mountain-id="{{ mountain.pk }}" data-review-id="{{ review.pk }}">
                    {% csrf_token %}
                    {% if request.user in review.like_users.all %}
                      <button type="submit" id="like-{{ review.pk }}"  class="bi bi-hand-thumbs-up-fill like__hover text-primary"></button>
                    {% else %}
                      <button type="submit" id="like-{{ review.pk }}" class="bi bi-hand-thumbs-up like__hover"></button>
                    {% endif %}
                    <span class="me-3" id="rl_likes_count_{{ review.pk }}">
                      {{ review.like_users.count }}
                    </span>
                  </form>
                  {% if review == most_liked_review %}
                    <img class="mx-3" style="width: 20px; height: 20px;" src="{% static 'img/bestreview.png' %}" alt="bestreview">
                  {% endif %}
                </div>
                <div class="mountain__detail--reviewtagbox">
                  {% for tag in review.tags.all %}
                    <p>#{{tag}}</p>
                  {% endfor %}
                </div>
              </div>
            </div>
            <p class="mountain__detail--reviewcontent">{{ review.content }}</p>
          </div>
          <div class="mountain__detail--reviewcrt">
            {% if review.created_at|date:"Y-m-d" >= now|date:"Y-m-d" %}
              {{ review.created_at|naturaltime }}
            {% else %}
              {{ review.created_at|date:"Y-m-d" }}
            {% endif %}
          </div>
          {% if review.user == request.user %}
            <div class="mountain__detail--updatebox">
              <!-- ìˆ˜ì • ë²„íŠ¼ -->
              <button class="editBtn" data-mountain-id="{{ review.mountain.pk }}" data-review-id="{{ review.pk }}">ìˆ˜ì •&nbsp</button>
              <span> Â·&nbsp</span>
              <form action="{% url 'mountains:review_delete' review.mountain.pk review.pk %}" method="POST">
                {% csrf_token %}
                <input type="submit" value="ì‚­ì œ">
              </form>
            </div>
          {% endif %}
        </div>
      </li>
      {% endfor %}
    </ul>
    {% if reviews|length > 5 %}
    {% endif %}
    <div class="reviewBtnbox">
      <button id="reviewloadMoreBtn" class="reviewloadMoreBtn" {% if reviews|length <= 5 %}style="display: none;"{% endif %}>ë”ë³´ê¸°</button>
      <button id="reviewCloseBtn" class="reviewCloseBtn" style="display: none;">ë‹« ê¸°</button>
    </div>
  </section>
    
  <hr style="margin-bottom: 30px;">    

  <section class="mountain__info--wrap">
    {% comment %} ë§ˆì´ì½”ìŠ¤ {% endcomment %}
    <h1 class="mountain__detail--atpoststitle">ë§ˆì´ì½”ìŠ¤<span class="mountain__detail--atpoststitle2">{{ mountain.post_set.all|length }}</span></h1>
    <div class="mountain__detail--atpostswrap">
      {% if mountain.post_set.all %}
        <div class="owl-carousel">
          {% for post in mountain.post_set.all %}
            <div class="max-w-sm bg-white border border-gray-200 rounded-lg">
              <a href="{% url 'posts:detail' post.pk %}"  class="position--relative">
                <div class="mountain__detail--atpostsimgbox">
                  {% with first_image_url=post.content|get_first_image_from_content %}
                    {% if first_image_url %}
                      <img class="mountain__detail--atpostsimg" src="{{ first_image_url }}" alt="ì¸ë„¤ì¼">
                    {% else %}
                      <img class="mountain__detail--atpostsimg" src="{% static 'img/Noimage.png' %}" alt="ëŒ€ì²´ì´ë¯¸ì§€">
                    {% endif %}
                  {% endwith %}
                </div>
                <div class="p-3 flex--col flex__align--between" style="">
                  <h5 class="title--wrap">{{ post.title }}</h5>
                  <div class="mountain__detail--atpostsuser">
                    <div class="mountain__detail--atpostsuserimgbox">
                      {% if post.user.profile_img %}
                        <img class="mountain__detail--atpostsuserimg {% if post.user.level == 2 %}level2 {% elif post.user.level == 3 %}level3 {% elif post.user.level == 4 %}level4 {% elif post.user.level == 5 %}level5 {% endif %}" src="{{ post.user.profile_img.url }}" alt="ìœ ì €í”„ë¡œí•„">
                        {% if post.user.level == 5 %}
                          <img class="level5--img" src="{% static 'img/crown.png' %}" alt="level5">
                        {% endif %}
                      {% else %}
                        <img class="mountain__detail--atpostsuserimg {% if post.user.level == 2 %}level2 {% elif post.user.level == 3 %}level3 {% elif post.user.level == 4 %}level4 {% elif post.user.level == 5 %}level5 {% endif %}" src="{% static 'img/profile_no_img.png' %}" alt="ëŒ€ì²´í”„ë¡œí•„">
                        {% if post.user.level == 5 %}
                          <img class="level5--img" src="{% static 'img/crown.png' %}" alt="level5">
                        {% endif %}
                      {% endif %}
                    </div>
                    <p class="mountain__detail--atpostsusername">{{ post.user.nickname }}</p>
                  </div>
                  <div class="flex--row flex__align--between">
                    <div class="flex--row flex__align--between">
                      <div class="flex--row pe-2">
                        <i class="bi bi-heart-fill pe-1" style="color:var(--red-color)"></i>
                        <p class="mountain__detail--atpostslikecount" data-like={{ post.pk }}>{{post.like_users.count}}</p>
                      </div>
                      <div class="flex--row pe-2">
                        <i class="bi bi-chat-dots-fill pe-1" style="color:var(--green-btn)"></i>
                        <p>{{post.postcomment_set.all|length}}</p>
                      </div>
                      <div class="flex--row">
                        <i class="bi bi-eye-fill pe-1" style="color: var(--sub-color);"></i>
                        <p>{{post.view_count}}</p>
                      </div>
                    </div>
                    <div>
                      <p style="color: var(--sub-color);">{{ post.created_at|date:"y. m. d" }}</p>
                    </div>
                  </div>
                </div>
              </a>
            </div>
          {% endfor %}
        </div>
      {% else %}
       <p class="mountain__detail--atpostsnonewrite"> ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. </p>
      {% endif %}
    </div>
  </section>
</div>

<p id="latitude" style="display: none;">{{ mountain.geom.y }}</p>
<p id="longitude" style="display: none;">{{ mountain.geom.x }}</p>
{% endblock content %}


{% block etc %}
<div class="mountain__btn__wrap">
  <div class="flex-col flex__align--between">
    <button type="submit" id="go-comment-section" class="mountain__btn--style icon--size1" title="ì¡°íšŒìˆ˜"><i class="bi bi-eye-fill like__hover"></i></button>
    <div class="text-center">{{ mountain.views }}</div>
  </div>
  <form class="like-form" data-mountain-id="{{ mountain.pk }}">
    {% csrf_token %}
    {% if request.user in mountain.likes.all %}
      <button type="submit" class="mountain__btn--style bi bi-heart-fill heart--color like__hover icon--size" id="mountain-likes-btn" title="ì¢‹ì•„ìš”"></button>
    {% else %}
      <button type="submit" class="mountain__btn--style bi bi-heart like__hover icon--size" id="mountain-likes-btn" title="ì¢‹ì•„ìš”"></button>
    {% endif %}
    <div id="mountain-likes-count" class="text-center">{{ mountain.likes.count }}</div> 
  </form>   
  <div class="flex--d-col flex--between">
    <button type="submit" id="go-review-section" class="mountain__btn--style icon--size" title="ë¦¬ë·°"><i class="bi bi-pencil like__hover"></i></button>
    <div class="text-center">{{ reviews|length }}</div>
  </div>
</div>
{% endblock etc %}



{% block javascript %}
<script src="{% static 'js/apikey.js' %}"></script>
<!-- ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ -->
<script>
  function loadKakaoMapScript(callback) {
    if (window.kakao) {
      // ì´ë¯¸ ì¹´ì¹´ì˜¤ë§µ APIê°€ ë¡œë“œë˜ì–´ ìˆëŠ” ê²½ìš°
      callback();
    } else {
      // ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ
      const API_KEY = config.apikey;
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src = `https://dapi.kakao.com/v2/maps/sdk.js?appkey=${API_KEY}&libraries=services&autoload=false`;
      script.async = true;
      script.onload = function() {
        kakao.maps.load(callback);
      };
      document.head.appendChild(script);
    }
  }

  // ì‚° ì¢Œí‘œë¥¼ ì°ëŠ” ì¹´ì¹´ì˜¤ MAP
  function showMountainMarker(latitude, longitude) {
    var container = document.getElementById('mountain-map');
    var options = {
      center: new kakao.maps.LatLng(latitude, longitude),
      level: 10
    };
    var map = new kakao.maps.Map(container, options);
  
    var markerPosition = new kakao.maps.LatLng(latitude, longitude);
  
    var marker = new kakao.maps.Marker({
      position: markerPosition
    });
  
    marker.setMap(map);
  }
    
// ì¹´ì¹´ì˜¤ë§µ ì´ˆê¸°í™” í•¨ìˆ˜
function initMap(courseId, course) {
  var container = document.querySelector('#map2-' + courseId);
  var options = {
    center: new kakao.maps.LatLng(37.5665, 126.9780), 
    level: 7
  };
  var map = new kakao.maps.Map(container, options);

  var linePath = [];

  var linePath = course.features[0].geometry.coordinates.map(function(coordinate) {
    var x = coordinate[0];
    var y = coordinate[1];
    return new kakao.maps.LatLng(y, x);
  });

  // ì¶œë°œ ì¢Œí‘œì— ë§ˆì»¤ í‘œì‹œ
  var startMarkerPosition = linePath[0];
  var startMarkerImage = new kakao.maps.MarkerImage(
    '/static/img/icons/start.png',
    new kakao.maps.Size(100, 100),
    { offset: new kakao.maps.Point(50, 80) }
    );
  var startMarker = new kakao.maps.Marker({
    position: startMarkerPosition,
    map: map,
    title: "ì¶œë°œì§€",
    image: startMarkerImage,
  });

  // ë„ì°© ì¢Œí‘œì— ë§ˆì»¤ í‘œì‹œ
  var endMarkerPosition = linePath[linePath.length - 1];
  var endMarkerImage = new kakao.maps.MarkerImage(
    '/static/img/icons/end.png',
    new kakao.maps.Size(100, 100),
    { offset: new kakao.maps.Point(50, 80) }
    );
  var endMarker = new kakao.maps.Marker({
    position: endMarkerPosition,
    map: map,
    title: "ë„ì°©ì§€",
    image: endMarkerImage,
  });
      
  // ì¤‘ê°„ ì¸ë±ìŠ¤ ê³„ì‚°
  var middleIndex = Math.floor(linePath.length / 2);
  var center = linePath[middleIndex];

  // Polylineì„ ì´ìš©í•˜ì—¬ ì„  ê·¸ë¦¬ê¸°
  var polyline = new kakao.maps.Polyline({
    path: linePath, // linePathì— ì €ì¥ëœ ì¢Œí‘œë“¤ë¡œ ì„¤ì •
    strokeWeight: 3,
    strokeColor: '#FF0000',
    strokeOpacity: 0.7,
    strokeStyle: 'solid'
  });
  polyline.setMap(map);

  // ë¶€ë“œëŸ½ê²Œ ë§ˆì»¤ê°€ ìœ„ì¹˜í•œ ê³³ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤
  map.panTo(center);
};


  // ì¹´ì¹´ì˜¤ë§µ API ë¡œë“œ í›„ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
  loadKakaoMapScript(function () {
    // ì‚°ì˜ ìœ„ì¹˜ì— ë§ˆì»¤ í‘œì‹œ
    var mountainLatitude = parseFloat(document.getElementById('latitude').textContent);
    var mountainLongitude = parseFloat(document.getElementById('longitude').textContent);
    showMountainMarker(mountainLatitude, mountainLongitude);

    var course_data = {{ courses_data|safe }};
    {% for course in courses|slice:":3" %}
      var courseId = {{ course.pk }}
      var course = JSON.parse(course_data[courseId]);
      initMap(courseId, course);
    {% endfor %}
  });
</script>

<script>
  var map;

  function initializeMap() {
    var container = document.getElementById('mountain-map');
    var options = {
      center: new kakao.maps.LatLng(37.5665, 126.9780),
      level: 7
    };
    map = new kakao.maps.Map(container, options);
  }

  // ëª¨ë‹¬ì´ ì—´ë¦´ ë•Œ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
  $(document).ready(function() {
    $('#mountainMap').on('shown.bs.modal', function (e) {
      initializeMap();
      console.log
      console.log('ì„±ê³µ')

      var latitude = parseFloat(document.getElementById('latitude').textContent);
      var longitude = parseFloat(document.getElementById('longitude').textContent);
      showMountainMarker(latitude, longitude);
    });
  });
</script>

<script>
  function bookmark(courseId) {
    const bookmarkBtn = document.getElementById('bookmark-btn-' + courseId);
    const mountainCsrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value;

    if (bookmarkBtn) {
      bookmarkBtn.addEventListener('click', () => {
        event.preventDefault(); // í¼ì˜ ê¸°ë³¸ ë™ì‘ ì¤‘ì§€
        const mountainPk = bookmarkBtn.getAttribute('data-mountain-pk');
        const coursePk = bookmarkBtn.getAttribute('data-course-pk');
        fetch(`/mountains/${mountainPk}/courses/${coursePk}/bookmark/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': mountainCsrftoken
          },
          body: JSON.stringify({})
        })
          .then(response => response.json())
          .then(data => {
            const isBookmarked = data.is_bookmarked;
            // ì„œë²„ë¡œë¶€í„°ì˜ ì‘ë‹µì„ ì²˜ë¦¬
            if (isBookmarked) {
              // ë¶ë§ˆí¬ ì¶”ê°€ ì‹œ ë™ì‘
              bookmarkBtn.className = 'bi bi-bookmark-fill btn--spot';
              alert('ë¶ë§ˆí¬ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } else {
              // ë¶ë§ˆí¬ ì œê±° ì‹œ ë™ì‘
              bookmarkBtn.className = 'bi bi-bookmark btn--spot';
              alert('ë¶ë§ˆí¬ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
          })
          .catch(error => {
            // ì—ëŸ¬ ì²˜ë¦¬
            console.error(error);
          });
      });
    }
  }

  {% for course in courses %}
    bookmark({{ course.pk }});
  {% endfor %}
</script>

<script>
  const forms = document.querySelectorAll(".like-form");
  const mountainCsrftokenLike = document.querySelector("[name=csrfmiddlewaretoken]").value;

  forms.forEach((form) => {
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const mountainId = e.target.dataset.mountainId;
      axios({
        method: 'post',
        url: `/mountains/${mountainId}/likes/`,
        headers: {"X-CSRFToken" : mountainCsrftokenLike},
      }).then((response) => {
        const isLiked = response.data.is_liked;
        const likeBtn = form.querySelector(`#mountain-likes-btn`);
        if (isLiked){
          likeBtn.className = 'mountain__btn--style bi bi-heart-fill heart--color like__hover icon--size';
        } else{
          likeBtn.className = 'mountain__btn--style bi bi-heart like__hover icon--size';
        }
        const likeCountTag = form.querySelector('#mountain-likes-count')
        const likeCountData = response.data.like_count
        likeCountTag.textContent = likeCountData
      })
      .catch((error) => {
        console.log(error.response)
      })
    })
  })
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var tagButtons = document.querySelectorAll('#review-tags label input');
    var selectedTagsContainer = document.getElementById('selected-tags');
  
    tagButtons.forEach(function(tagButton) {
      tagButton.addEventListener('click', function(event) {
        var label = this.parentElement;
        label.classList.toggle('selected');

        // ì„ íƒí•œ íƒœê·¸ ëª©ë¡ ì—…ë°ì´íŠ¸
        var selectedTags = document.querySelectorAll('#review-tags label.selected input');
        const selectedTagsCount = selectedTags.length;
        const fourTag = document.querySelector('.fourtag');

        // ê°œìˆ˜ê°€ 4ê°œì¼ë•Œ
        if (selectedTagsCount == 4){
          fourTag.style.display = "block";
          setTimeout(function() {
            fourTag.style.display = "none";
          }, 1500);
        } else {
          fourTag.style.display = "none";
        }

        // ì„ íƒëœ íƒœê·¸ ëª©ë¡ í‘œì‹œ
        var selectedTagsArray = Array.from(selectedTags).map(function(input) {
          var inputName = '# ' + input.getAttribute('data-tag-name');
          return '<div class="mountain__reviewcrt--tag selected">' + inputName + '</div>';
        });

        // ì„ íƒëœ íƒœê·¸ë“¤ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•œ ë¬¸ìì—´ë¡œ ì„¤ì •í•˜ì—¬ selectedTagsContainer ë‚´ì— ì—…ë°ì´íŠ¸
        selectedTagsContainer.innerHTML = selectedTagsArray.join(' ');
      });
    });
  });
</script>
  
<script>
  // ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì‹œ ìƒˆ ì°½ ì—´ê¸°
  var editButtons = document.getElementsByClassName("editBtn");

  for (var i = 0; i < editButtons.length; i++) {
    var editButton = editButtons[i];

    editButton.addEventListener("click", function () {
      var reviewId = this.getAttribute("data-review-id");
      var mountainId = this.getAttribute("data-mountain-id");

      var url = '/mountains/' + mountainId + '/review/' + reviewId + '/update/';
      var features = 'width=1000,height=380,resizable=yes';
      window.open(url, '_blank', features);
    });
  }
</script>

<script>
  
  document.getElementById('reviewloadMoreBtn').addEventListener('click', function() {
    var reviewList = document.getElementById('reviewList');    
    var hiddenItems = reviewList.querySelectorAll('li[style="display: none;"]');
    var visibleItems = reviewList.querySelectorAll('li:not([style="display: none;"])');
    console.log(hiddenItems)
  
    if (visibleItems.length < reviewList.children.length) {
      for (var i = 0; i < hiddenItems.length && i < 5; i++) {
        hiddenItems[i].style.display = 'block';
      }    
    }

    var NewhiddenItems = reviewList.querySelectorAll('li[style="display: none;"]');

    if (NewhiddenItems.length === 0) {
      document.getElementById('reviewloadMoreBtn').style.display = 'none';
      document.getElementById('reviewCloseBtn').style.display = 'inline-block';
    }
  });

  
  document.getElementById('reviewCloseBtn').addEventListener('click', function() {
    var reviewList = document.getElementById('reviewList');
    var items = reviewList.querySelectorAll('li');
  
    for (var i = 5; i < items.length; i++) {
      items[i].style.display = 'none';
    }
  
    this.style.display = 'none';
    document.getElementById('reviewloadMoreBtn').style.display = 'inline-block';
  });  
</script>

<script>
  function limitCheckboxSelections(checkbox, limit) {
    var checkedCount = 0;
    var checkboxes = checkbox.closest('form').querySelectorAll('input[type="checkbox"]');
    
    for (var i = 0; i < checkboxes.length; i++) {
      if (checkboxes[i].checked) {
        checkedCount++;
      }
      if (checkedCount >= limit) {
        for (var j = 0; j < checkboxes.length; j++) {
          if (!checkboxes[j].checked) {
            checkboxes[j].disabled = true;
          }
        }
        break;
      } else {
        checkboxes[i].disabled = false;
      }
    }
  }
</script>


<script>
  var imageInputs = document.querySelectorAll("#review-image input[type=file]");

  // ì´ë¯¸ì§€ íŒŒì¼ ë³€ê²½ ì‹œ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
  imageInputs.forEach(function (input) {
    input.addEventListener("change", function (event) {
      var file = event.target.files[0];
      
      if (file) {
        var reader = new FileReader();
        preview.style.display = "block";
        console.log(preview)
        console.log(reader)
        reader.onload = function (e) {
          preview.src = e.target.result;
          preview.style.display = "block";    
        };
        reader.readAsDataURL(file);
      } else {
        preview.src = "";
        preview.style.display = "none";
      }
    });
  });
</script>

<script>
  document.getElementById('go-review-section').addEventListener('click', function() {
    var element = document.querySelector('.mountain__detail--reviewtitle');
    element.scrollIntoView({ behavior: 'smooth' });
  });
</script>

<script>
  // review ì¢‹ì•„ìš”
  const reviewLikeForms = document.querySelectorAll('.review-like-form');
  const rlcsrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
  reviewLikeForms.forEach(form => {
    form.addEventListener('submit', function (event) {
      event.preventDefault()
      const mountainId = event.target.dataset.mountainId;
      const reviewId = event.target.dataset.reviewId;
      axios({
        method: 'post',
        url: `/mountains/${mountainId}/review/${reviewId}/likes/`,
        headers: {'X-CSRFToken': rlcsrfToken},
      }).then((response) => {
        const isLiked = response.data.rl_is_liked
        const likeBtn = document.querySelector(`#like-${reviewId}`)
        if (isLiked){
          console.log('dd')
          likeBtn.className = "bi bi-hand-thumbs-up-fill like__hover text-primary";
        } else {
          likeBtn.className = "bi bi-hand-thumbs-up like__hover";
        }

        const likesCountData = response.data.rl_likes_count
        const likesCountTag = document.querySelector(`#rl_likes_count_${reviewId}`)
        likesCountTag.textContent = likesCountData

      })
      .catch((error) => {
        console.error(response.data);
      });
    });
  });
  ;
</script>

<script>
  // JavaScript
  var imageInput = document.getElementById('id_image');
  var imgPreview = document.getElementById('preview');
  var iplus = document.querySelector(".img--plus")

  imageInput.addEventListener('change', function(event) {
    if (event.target.files && event.target.files[0]) {
      imgPreview.style.display = 'block';
      iplus.style.display = "none";
      document.querySelector('.mountain__reviewcrt--imgbox').style.border = 'none';
    } else {
      imgPreview.style.display = 'none';
      iplus.style.display = "block";
      document.querySelector('.mountain__reviewcrt--imgbox').style.border = '2px dashed #777777';
      document.querySelector('.mountain__reviewcrt--imgbox').addEventListener('mouseenter', () => {document.querySelector('.mountain__reviewcrt--imgbox').style.border = '2px dashed var(--green-btn)'})
    }
  });
</script>
<script>
  // mountain info ëª¨ë‹¬
  // ë”ë³´ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ì—´ê¸°
  document.querySelector('.show-info-modal').addEventListener('click', function() {
    document.getElementById('info-modal').classList.remove('hidden');
  });

  // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
  document.querySelector('.close-info-modal').addEventListener('click', function() {
    document.getElementById('info-modal').classList.add('hidden');
  });
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const commentElement = document.getElementById('bestReview');
    const viewCommentButton = document.getElementById('viewCommentButton');
  
    if (commentElement.scrollHeight > commentElement.clientHeight) {
      commentElement.classList.add('clamp'); // í…ìŠ¤íŠ¸ í´ë¨í•‘ì„ ìœ„í•œ í´ë˜ìŠ¤ ì¶”ê°€
      viewCommentButton.classList.remove('hidden'); // ë²„íŠ¼ì„ ë³´ì´ë„ë¡ í´ë˜ìŠ¤ ì œê±°
    }
  });  


  function scrollToComment() {
    const bestReviewId = "{{ most_liked_review.pk }}"; // í•´ë‹¹ ë¦¬ë·°ì˜ ê³ ìœ  ì‹ë³„ì ê°€ì ¸ì˜¤ê¸°
    const bestReviewElement = document.getElementById(`best-${bestReviewId}`);

    if (bestReviewElement.style.display === "none") {
      bestReviewElement.style.display = "block";
    }
    
    bestReviewElement.scrollIntoView({ behavior: 'smooth' }); // í•´ë‹¹ ë¦¬ë·°ë¡œ ìŠ¤í¬ë¡¤ ì´ë™
  }
</script>

<script>
  $(document).ready(function() {
    $(".owl-carousel").owlCarousel({
      // OwlCarousel ì˜µì…˜ ì„¤ì •
      items: 4, // í•œ ë²ˆì— í‘œì‹œí•  ì•„ì´í…œ ìˆ˜
      loop: false, // ë¬´í•œ ë£¨í”„ ì—¬ë¶€
      margin: 20, // ì•„ì´í…œ ê°„ì˜ ê°„ê²©
      nav: true, // ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ í‘œì‹œ ì—¬ë¶€
      navText: ["<", ">"],
      dots: true, // ë„íŠ¸ í‘œì‹œ ì—¬ë¶€
      responsive: {
        // ë°˜ì‘í˜• ì˜µì…˜ ì„¤ì •
        0: {
          items: 1 // 0px ì´ìƒì¼ ë•Œ, 1ê°œì˜ ì•„ì´í…œ í‘œì‹œ
        },
        768: {
          items: 2 // 768px ì´ìƒì¼ ë•Œ, 2ê°œì˜ ì•„ì´í…œ í‘œì‹œ
        },
        1080: {
          items: 4 // 1080px ì´ìƒì¼ ë•Œ, 4ê°œì˜ ì•„ì´í…œ í‘œì‹œ
        }
      }
    });
  });
</script>

<script>
  const downloadForms = document.querySelectorAll('.download-form');

  downloadForms.forEach(function(form) {
    form.addEventListener('submit', function(e) {
      e.preventDefault(); // ê¸°ë³¸ í¼ ì œì¶œ ë™ì‘ì„ ë§‰ìŠµë‹ˆë‹¤.
      const gpxId = e.target.dataset.gpxId;
      const mountainId = e.target.dataset.mountainId;
      var confirmation = confirm("ë©”ì¼ì„ ì „ì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"); // í™•ì¸ ì°½ì„ ë„ì›ë‹ˆë‹¤.

      if (confirmation) {
        axios({
          method: 'post',
          url: `/mountains/${mountainId}/courses/${gpxId}/download/`,
          headers: {
            'X-CSRFToken': this.querySelector('input[name="csrfmiddlewaretoken"]').value
          }
        })
        .then(response => {
          if (response.status === 200) {
            // ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°›ì•˜ì„ ë•Œ
            alert("GPX íŒŒì¼ì„ ë“±ë¡í•œ ì´ë©”ì¼ë¡œ ì „ì†¡í–ˆìŠµë‹ˆë‹¤.");
          }
        })
        .catch(error => {
          // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“±ì˜ ë¬¸ì œë¡œ ì‹¤íŒ¨í–ˆì„ ë•Œ
          if (error.response) {
            // ì„œë²„ê°€ ì˜¤ë¥˜ ì‘ë‹µì„ ë°˜í™˜í•œ ê²½ìš°
            alert("ì´ë©”ì¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ë©”ì¼ ë“±ë¡ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê³ , ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
          } else {
            // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“±ì˜ ë¬¸ì œë¡œ ì‹¤íŒ¨í•œ ê²½ìš°
            alert("ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        });
      }
      }
  )})
</script>
<script>
  $(document).ready(function() {
    // ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ë¹„ë™ê¸°ì ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤
    function fetchNewsData(mountainId) {
        $.ajax({
            url: `get_news/`,
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                // ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ HTML ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤
                const newsListContainer = $('.mountains__detail--newslist');
                newsListContainer.empty(); // ê¸°ì¡´ ë‚´ìš© ì§€ìš°ê¸°

                // ë‰´ìŠ¤ ì œëª© ë¶€ë¶„ ì¶”ê°€
                const newsTitle = $('<p>').addClass('mountains__detail--newstitle').text('ê´€ë ¨ ë‰´ìŠ¤');
                  newsListContainer.append(newsTitle);

                // ë‰´ìŠ¤ ì•„ì´í…œì„ ë°˜ë³µí•˜ì—¬ ì¶”ê°€í•©ë‹ˆë‹¤
                data.result.forEach(function(item) {
                    const newsItemLink = $('<a>').addClass('mountains__detail--newsitem').attr('href', item.link);
                    const newsItemTitle = $('<p>').attr('title', item.title).text(item.title);

                    newsItemLink.append(newsItemTitle);
                    newsListContainer.append(newsItemLink);
                });
            },
            error: function() {
                console.error('ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });
    }

    function fetchAirData(mountainId) {
      $.ajax({
          url: `get_air/`, // ì‹¤ì œ URLë¡œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”
          method: 'GET',
          dataType: 'json',
          success: function(data) {
              // ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ HTML ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤
              const region = data.region;
              const fineDust = data.fine_dust;
              const ozone = data.ozone;

              // ë¯¸ì„¸ë¨¼ì§€ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
              const fineDustContainer = $('.air--fine_dust');
              fineDustContainer.empty();
              const fineDustTitle = $('<p>').text(`ë¯¸ì„¸ë¨¼ì§€ ${fineDust[region]}`);
              fineDustContainer.append(fineDustTitle);

              // ë¯¸ì„¸ë¨¼ì§€ ì´ë¯¸ì§€ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
              const fineDustImg = $('<img>').addClass('air--img').attr('src', fineDust[region] === 'ì¢‹ìŒ' ? '{% static 'img/air/smile.png' %}' : (fineDust[region] === 'ë³´í†µ' ? '{% static 'img/air/neutral.png' %}' : '{% static 'img/air/sad.png' %}')).attr('alt', `ë¯¸ì„¸ë¨¼ì§€${fineDust[region]}`);
              fineDustContainer.prepend(fineDustImg);

              // ì˜¤ì¡´ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
              const ozoneContainer = $('.air--ozone');
              ozoneContainer.empty();
              const ozoneTitle = $('<p>').text(`ì˜¤ì¡´ ${ozone[region]}`);
              ozoneContainer.append(ozoneTitle);

              // ì˜¤ì¡´ ì´ë¯¸ì§€ ì—˜ë¦¬ë¨¼íŠ¸ ì—…ë°ì´íŠ¸
              const ozoneImg = $('<img>').addClass('air--img').attr('src', ozone[region] === 'ì¢‹ìŒ' ? '{% static 'img/air/smile.png' %}' : (ozone[region] === 'ë³´í†µ' ? '{% static 'img/air/neutral.png' %}' : '{% static 'img/air/sad.png' %}')).attr('alt', `ì˜¤ì¡´${ozone[region]}`);
              ozoneContainer.prepend(ozoneImg);
          },
          error: function() {
              console.error('ëŒ€ê¸° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
      });
  }
  function fetchWeatherData(mountainId) {
    $.ajax({
        url: `get_weather_forecast/`,
        method: 'GET',
        dataType: 'json',
        success: function(data) {
            // ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ HTML ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤
            const weatherContainer = $('.weather--wrap');
            // í•˜ëŠ˜ìƒíƒœ ì´ë¯¸ì§€ ì—…ë°ì´íŠ¸
            const skyImg = weatherContainer.find('.weather--skyimg');
            if (data.sun.indexOf(data.now_time) !== -1) {
                if (data.sky === '1') {
                    skyImg.attr('src', '{% static "img/weather/sunny.png" %}');
                    skyImg.attr('alt', 'ì•„ì¹¨ë§‘ìŒ');
                    skyImg.attr('title', 'ë§‘ìŒ');
                } else if (data.sky === '3') {
                    skyImg.attr('src', '{% static "img/weather/suncloudy.png" %}');
                    skyImg.attr('alt', 'ì•„ì¹¨êµ¬ë¦„ë§ìŒ');
                    skyImg.attr('title', 'êµ¬ë¦„ë§ìŒ');
                } else if (data.sky === '4') {
                    skyImg.attr('src', '{% static "img/weather/overcast.png" %}');
                    skyImg.attr('alt', 'íë¦¼');
                    skyImg.attr('title', 'íë¦¼');
                }
            } else {
                if (data.sky === '1') {
                    skyImg.attr('src', '{% static "img/weather/moon.png" %}');
                    skyImg.attr('alt', 'ì €ë…ë§‘ìŒ');
                    skyImg.attr('title', 'ë§‘ìŒ');
                } else if (data.sky === '3') {
                    skyImg.attr('src', '{% static "img/weather/mooncloudy.png" %}');
                    skyImg.attr('alt', 'ì €ë…êµ¬ë¦„ë§ìŒ');
                    skyImg.attr('title', 'êµ¬ë¦„ë§ìŒ');
                } else if (data.sky === '4') {
                    skyImg.attr('src', '{% static "img/weather/overcast.png" %}');
                    skyImg.attr('alt', 'íë¦¼');
                    skyImg.attr('title', 'íë¦¼');
                }
            }

            // ê¸°ì˜¨ ì—…ë°ì´íŠ¸
            weatherContainer.find('.weather--tem').text(data.tem);

            // ìŠµë„ ì—…ë°ì´íŠ¸
            weatherContainer.find('.weather--hvwr[data-type="hum"]').find('p:last-child').text(data.hum + ' %');

            // ë°”ëŒ ì—…ë°ì´íŠ¸
            weatherContainer.find('.weather--hvwr[data-type="wsd"]').find('p:last-child').text(data.vec + ' ' + data.wsd + ' m/s');

            // 1ì‹œê°„ ê°•ìˆ˜ëŸ‰ ì—…ë°ì´íŠ¸
            const rainContainer = weatherContainer.find('.weather--hvwr[data-type="rain"]').find('p:last-child');
            if (data.rain === 'ê°•ìˆ˜ì—†ìŒ') {
                rainContainer.text('- mm');
            } else {
                rainContainer.text(data.rain);
            }
        },
        error: function() {
            console.error('ë‚ ì”¨ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });
}

    // í˜ì´ì§€ ë¡œë”© ì‹œ ë‰´ìŠ¤ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤
    const mountainId = {{ mountain.pk }}
    fetchNewsData(mountainId);
    fetchAirData(mountainId);
    fetchWeatherData(mountainId);
});
</script>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
{% endblock javascript %}